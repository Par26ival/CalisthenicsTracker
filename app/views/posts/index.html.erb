<div class="flex gap-4 mb-6 items-center">
  <%= link_to "ðŸ  Home",
        root_path,
        class: "px-4 py-2 rounded bg-gray-200 hover:bg-gray-300 font-medium" %>

  <%= link_to "âž• New Post",
        new_post_path,
        class: "px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700 font-medium" %>

  <div class="ml-auto">
    <%= form_with url: posts_path, method: :get, local: true do |f| %>
      <div class="flex gap-2 items-center">
        <%= f.label :skill_id, "Filter by skill:",
              class: "text-sm text-gray-600" %>

        <%= f.select :skill_id,
              options_from_collection_for_select(@skills, :id, :name, params[:skill_id]),
              { include_blank: "All skills" },
              class: "border rounded p-2" %>

        <%= f.submit "Apply",
              class: "px-3 py-2 rounded bg-gray-200 hover:bg-gray-300 text-sm" %>
      </div>
    <% end %>
  </div>
</div>

<div id="posts">
  <% @posts.each do |post| %>
    <div class="post-card border rounded-lg p-4 mb-4 bg-white shadow-sm">
      <strong><%= post.user.username %></strong>

      <small class="block text-gray-500">
        <%= time_ago_in_words(post.created_at) %> ago
      </small>

      <% if post.skills.any? %>
        <div class="mt-2 flex flex-wrap gap-2">
          <% post.skills.each do |skill| %>
            <span class="text-xs px-2 py-1 rounded bg-gray-100 text-gray-700">
              <%= skill.name %>
            </span>
          <% end %>
        </div>
      <% end %>

      <p class="mt-2">
        <%= truncate(strip_tags(post.content), length: 200) %>
      </p>

      <% if post.media.attached? %>
        <div class="mt-3 space-y-2">
          <% post.media.each do |file| %>
            <% if file.image? %>
              <%= image_tag file,
                    class: "max-w-full rounded",
                    loading: "lazy" %>
            <% elsif file.video? %>
              <%= video_tag file,
                    controls: true,
                    class: "max-w-full rounded" %>
            <% end %>
          <% end %>
        </div>
      <% end %>

      <div class="flex gap-4 mt-3 items-center">
        <%= link_to "Browse Post",
              post_path(post),
              class: "inline-block px-3 py-1 rounded bg-indigo-100 text-indigo-700 hover:bg-indigo-200 text-sm font-medium" %>

        <% if current_user.admin? || post.user == current_user %>
          <%= button_to "Delete",
                post_path(post),
                method: :delete,
                data: { confirm: "Are you sure?" },
                class: "text-red-600 text-sm" %>
        <% end %>
      </div>
    </div>
  <% end %>
</div>
