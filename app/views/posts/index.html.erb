<h1>All Posts</h1>

<%= link_to "New Post", new_post_path, class: "btn" %>

<hr>

<div id="posts">
  <% @posts.each do |post| %>
    <div class="post-card">
      <strong><%= post.user.username %></strong>

      <small class="block text-gray-500">
        <%= time_ago_in_words(post.created_at) %> ago
      </small>

      <p class="mt-2">
        <%= truncate(strip_tags(post.content), length: 200) %>
      </p>

      <% if post.media.attached? %>
        <div class="mt-3 space-y-2">
          <% post.media.each do |file| %>
            <% if file.image? %>
              <%= image_tag file,
                    class: "max-w-full rounded",
                    loading: "lazy" %>
            <% elsif file.video? %>
              <%= video_tag file,
                    controls: true,
                    class: "max-w-full rounded" %>
            <% end %>
          <% end %>
        </div>
      <% end %>
      
      <div class="flex gap-4 mt-2">
        <%= link_to "View", post_path(post), class: "text-blue-600" %>

        <% if current_user.admin? || post.user == current_user %>
          <%= button_to "Delete",
                post_path(post),
                method: :delete,
                data: { confirm: "Are you sure?" },
                class: "text-red-600" %>
        <% end %>
      </div>
    </div>
  <% end %>
</div>